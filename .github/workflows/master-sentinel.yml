name: ðŸ”„ Continuous Bug Bounty Scanner Pro

on:
  schedule:
    # Run every 6 hours
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  dispatch_scans:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ðŸŽ¯ Load Targets & Dispatch Scans
        run: |
          echo "ðŸŽ¯ Loading targets from bug_bounty_targets.txt..."
          
          if [ ! -f "bug_bounty_targets.txt" ]; then
            echo "âŒ bug_bounty_targets.txt not found!"
            exit 1
          fi
          
          # Read targets (skip comments and empty lines)
          TARGETS=$(grep -v '^#' bug_bounty_targets.txt | grep -v '^$' | head -50)
          TARGET_COUNT=$(echo "$TARGETS" | wc -l)
          
          echo "ðŸ“Š Found $TARGET_COUNT targets to scan"
          
          SCAN_ID=$(date +%s)
          DISPATCHED=0
          
          # Dispatch scans for each target
          while IFS= read -r target; do
            if [ -n "$target" ]; then
              echo "ðŸš€ Dispatching scan for: $target"
              
              curl -X POST \
                -H "Accept: application/vnd.github+json" \
                -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                -H "X-GitHub-Api-Version: 2022-11-28" \
                https://api.github.com/repos/${{ github.repository }}/dispatches \
                -d "{
                  \"event_type\": \"scan_target\",
                  \"client_payload\": {
                    \"target\": \"$target\",
                    \"intensity\": \"2\",
                    \"ai_analysis\": \"true\",
                    \"notification_mode\": \"all\",
                    \"scan_id\": \"${SCAN_ID}_${DISPATCHED}\"
                  }
                }" 2>/dev/null
              
              ((DISPATCHED++))
              sleep 5
            fi
          done <<< "$TARGETS"
          
          echo "âœ… Dispatched $DISPATCHED scans"
          echo "dispatched=$DISPATCHED" >> $GITHUB_OUTPUT
          
      - name: ðŸ“¤ Send Summary to Discord
        if: always()
        run: |
          DISPATCHED="${{ steps.dispatch.outputs.dispatched || '0' }}"
          
          curl -H "Content-Type: application/json" \
            -d "{
              \"embeds\": [{
                \"title\": \"ðŸ”„ Continuous Scan Initiated\",
                \"description\": \"**Automated bug bounty scanning started**\",
                \"color\": 3447003,
                \"fields\": [
                  {\"name\": \"ðŸ“Š Targets Scanned\", \"value\": \"$DISPATCHED\", \"inline\": true},
                  {\"name\": \"â° Started\", \"value\": \"$(date -u +%Y-%m-%d\ %H:%M:%S) UTC\", \"inline\": true},
                  {\"name\": \"âš¡ Intensity\", \"value\": \"Level 2\", \"inline\": true},
                  {\"name\": \"ðŸ¤– AI Analysis\", \"value\": \"Enabled\", \"inline\": true},
                  {\"name\": \"ðŸ”” Notifications\", \"value\": \"All Results\", \"inline\": true},
                  {\"name\": \"â±ï¸ Next Scan\", \"value\": \"In 6 hours\", \"inline\": true}
                ],
                \"footer\": {\"text\": \"Continuous Bug Bounty Scanner\"},
                \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
              }]
            }" "${{ secrets.DISCORD_WEBHOOK_URL }}" 2>/dev/null || true
          
          echo "âœ… Summary sent to Discord"
