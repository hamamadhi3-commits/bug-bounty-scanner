name: ğŸ§  Digital Sentinel PRIME v4.0 â€“ Deep Autonomous Hunter

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"  # Ú©Ø§Ø±Ú©Ø±Ø¯Ù† Ù‡Û•Ù…ÙˆÙˆ 6 Ú©Ø§ØªÚ˜Ù…ÛØ± Ø¬Ø§Ø±ÛÚ©

jobs:
  update_and_dispatch:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ“¦ Install dependencies
        run: |
          pip install -r requirements.txt || pip install requests

      - name: ğŸ§­ Update target list from Bugcrowd
        run: python3 src/update_targets.py

      - name: ğŸš€ Dispatch scans for all targets
        run: |
          echo "ğŸ“¡ Dispatching Deep Scan to all 4 parallel workers..."
          python3 src/dispatch_scans.py || echo "âš ï¸ Dispatch failed, skipping."

      - name: ğŸ¤– Generate AI Summary Report
        run: python3 src/ai_report.py || echo "No AI report generated."

      - name: ğŸ“¢ Send summary to Discord
        run: python3 src/discord_notify.py || echo "No Discord summary."

  # -----------------------------
  # ğŸ§  DAILY DASHBOARD JOB
  # -----------------------------
  daily_dashboard:
    runs-on: ubuntu-latest
    needs: update_and_dispatch
    schedule:
      - cron: "0 18 * * *"  # Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ú•Û†Ú˜Ø§Ù†Û• Ù„Û• Ú©Ø§ØªÚ˜Ù…ÛØ±ÛŒ Ù¦ÛŒ Ø¦ÛÙˆØ§Ø±Û• Ø¨Û• UTC
    steps:
      - name: ğŸ“¥ Checkout repo
        uses: actions/checkout@v4

      - name: âš™ï¸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ§  Generate Daily Dashboard Report
        run: |
          pip install requests
          python3 src/monitor_dashboard.py
