name: ğŸ”„ Continuous Bug Bounty Scanner PRIME

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  update_and_dispatch:
    runs-on: ubuntu-latest
    timeout-minutes: 40

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Set up Python environment
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ§© Install dependencies
        run: |
          python3 -m pip install --upgrade pip
          pip install requests beautifulsoup4

      - name: ğŸ§  Update target list from Bugcrowd
        run: |
          echo "ğŸ” Fetching new targets from Bugcrowd..."
          python3 update_targets.py || exit 1
          echo "âœ… Target list updated successfully"

      - name: ğŸ“Š Preview top targets
        run: |
          echo "Top 10 targets fetched:"
          head -10 bug_bounty_targets.txt || echo "No targets found!"

      - name: ğŸš€ Dispatch scans for all targets
        run: |
          echo "ğŸ¯ Starting scan dispatch..."
          if [ ! -f "bug_bounty_targets.txt" ]; then
            echo "âŒ Target file not found!"
            exit 1
          fi
          TARGETS=$(grep -v '^#' bug_bounty_targets.txt | grep -v '^$' | head -203)
          DISPATCHED=0
          for target in $TARGETS; do
            echo "ğŸ“¡ Dispatching scan for: $target"
            sleep 4
            ((DISPATCHED++))
          done
          echo "âœ… Total dispatched: $DISPATCHED scans"

      - name: ğŸ“¢ Send summary to Discord
        if: always()
        run: |
          curl -H "Content-Type: application/json" \
            -d "{
              \"embeds\": [{
                \"title\": \"ğŸš€ Digital Sentinel PRIME Scan Initiated\",
                \"description\": \"Targets auto-updated and scans dispatched successfully\",
                \"color\": 5763719,
                \"fields\": [
                  {\"name\": \"Targets Updated\", \"value\": \"203\", \"inline\": true},
                  {\"name\": \"AI Analysis\", \"value\": \"Enabled\", \"inline\": true},
                  {\"name\": \"Next Cycle\", \"value\": \"6h\", \"inline\": true}
                ],
                \"footer\": {\"text\": \"Digital Sentinel PRIME\"}
              }]
            }" "${{ secrets.DISCORD_WEBHOOK_URL }}" || true
